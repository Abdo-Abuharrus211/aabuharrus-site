---
import { getCollection } from "astro:content";
import SkillCard from "./skillCard.astro";
import SkillCarousel from "./skillCarousel.astro";

// TODO: I eventually want to make the carousel with the pop-ups
//  but first let's try making the stuff render...

const skills = await getCollection("skills");
---

<section id="skills-section center">
  <h1>Skills</h1>
  <div class="flex">
    {skills.map((skill: any) => <SkillCard skillProps={skill} />)}
  </div>
  <button id="skill-reset" class="outline-btn hidden" onclick="reset()"
    >Reset</button
  >
  <SkillCarousel />
</section>

<script is:inline>
  const resetBtn = document.getElementById("skill-reset");
  let shownSkills = [];

  /**
   * Remove the 'hidden' class from respective SkillCard to display details.
   *
   * @param element reference to DOM element to be made visible.
   */
  const unhide = (element) => {
    if (element.classList.contains("hidden")) {
      element.classList.remove("hidden");
    }
  };

  /**
   * Reset the array of visible SkillCards and hide them and the reset button.
   */
  function reset() {
    shownSkills.forEach((element) => {
      if (!element.classList.contains("hidden")) {
        element.classList.add("hidden");
      }
    });
    shownSkills = [];
    resetBtn.classList.add("hidden");
  }

  // Attach listeners and handle carousel item clicks to make SkillCards visible
  document.querySelectorAll(".carousel-item").forEach((item) => {
    item.addEventListener("click", (e) => {
      const idx = parseInt(item.getAttribute("data-index"));
      const newPopup = document.getElementById(`skill-${idx}`);
      if (!shownSkills.includes(newPopup)) {
        shownSkills.push(newPopup);
        unhide(newPopup);
      }
      resetBtn.classList.remove("hidden");
    });
  });
</script>
